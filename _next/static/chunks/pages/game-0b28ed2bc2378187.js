(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{171:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return n(4829)}])},4829:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var i=n(5893),r=n(185),a=n.n(r),s=n(1163),l=n(7294),o=n(2237);let u=(e,t)=>{let n=(t-e.createdAt)/1e3,i=300*n*e.direction.x,r=300*n*e.direction.y,a=e.createdPosition.x+i,s=e.createdPosition.y+r;return[a,s]},c=e=>{let{bullet:t,currentTime:n}=e,[r,a]=u(t,n);return(0,i.jsx)(o.Cd,{x:r,y:a,radius:5,fill:"red"})};var d=n(1290),h=n(6850),y=n.n(h);let x=()=>{let e=(0,s.useRouter)(),[t,n]=(0,l.useState)(0);return(0,l.useEffect)(()=>{let t=async()=>{let t=await d.x.game.config.$get();null!==t&&n(t),0===t&&e.push("/game/config")};t()},[e]),(0,i.jsxs)("div",{className:y().container,children:[(0,i.jsxs)("div",{className:y().title,children:[(0,i.jsx)("h1",{children:"Gradius"}),(0,i.jsx)("h2",{children:"Config"})]}),(0,i.jsx)("div",{className:y().buttons,children:[...Array(t)].map((t,n)=>(0,i.jsx)("button",{className:y().button,onClick:()=>e.push({query:{display:n}}),children:n},n))}),(0,i.jsx)("p",{className:y().text,children:"画面を選択してください"})]})};var f=n(1733),m=n(4420),p=n.n(m);let _=()=>{let e=(0,s.useRouter)(),t=void 0===e.query.display?null:Number(e.query.display);if(null===t)return(0,i.jsx)(x,{});let n=()=>{let[e,n]=(0,l.useState)([]),[r,s]=(0,l.useState)([]),[h,y]=(0,l.useState)([]),[x,m]=(0,l.useState)([]),[_,b]=(0,l.useState)(Date.now()),[g]=p()(f.D.images.spaceship_png),[w]=p()(f.D.images.ufo_jpg),[j]=p()(f.D.images.ufo_2_PNG),[v]=p()(f.D.images.ufo_3_PNG),P=(0,l.useRef)([]),N=async e=>{let t=await d.x.player.$get({query:{display:e}});null!==t&&n(t)},E=async e=>{let t=await d.x.enemy.$get({query:{display:e}});null!==t&&s(t)},M=async e=>{let t=await d.x.bullet.$get({query:{display:e}});null!==t&&(y(t.players),m(t.enemies))},q=async()=>{let e=[];for(let t of r){let n=h.find(e=>{let n=u(e,_),i=Math.pow(t.createdPosition.x-n[0],2)+Math.pow(t.createdPosition.y-n[1],2);return i<2500});n&&n.playerId?(await d.x.enemy.$delete({body:{enemyId:t.id,userId:n.playerId}}),await d.x.bullet.$delete({body:{bulletId:n.id}})):e.push(t)}},I=async()=>{let n=[];for(let i of r){let r=e.find(e=>{let t=Math.pow(i.createdPosition.x-e.position.x,2)+Math.pow(i.createdPosition.y-e.position.y,2);return t<2500});void 0!==r?d.x.game.$post({body:{player:r,enemy:i},query:{display:t}}):n.push(i)}};return(0,l.useEffect)(()=>{let e=requestAnimationFrame(()=>{N(t),E(t),M(t),q(),I(),b(Date.now())});return()=>cancelAnimationFrame(e)}),(0,l.useEffect)(()=>{var e,t;let n=new(a()).Animation(e=>{P.current.forEach(t=>{if(t.current){var n,i;t.current.offset({x:5*Math.cos(Math.floor(((null!==(n=null==e?void 0:e.time)&&void 0!==n?n:0)/10+t.current.x())*Math.PI)/100),y:5*Math.sin(Math.floor((null!==(i=null==e?void 0:e.time)&&void 0!==i?i:0)/10*Math.PI+t.current.y())/100)})}})},null===(e=P.current[0])||void 0===e?void 0:null===(t=e.current)||void 0===t?void 0:t.getLayer());return n.start(),()=>{n.stop()}},[]),(0,i.jsx)("div",{children:(0,i.jsxs)(o.Hf,{width:1920,height:1080,children:[(0,i.jsx)(o.mh,{children:h.map(e=>(0,i.jsx)(c,{bullet:e,currentTime:_},e.id))}),(0,i.jsx)(o.mh,{children:x.map(e=>(0,i.jsx)(c,{bullet:e,currentTime:_},e.id))}),(0,i.jsx)(o.mh,{children:e.map(e=>(0,i.jsx)(o.Ee,{image:g,width:100,height:100,rotation:"red"===e.team?90:-90,x:e.position.x+50,y:e.position.y-50},e.id))}),(0,i.jsx)(o.mh,{children:r.map((e,t)=>(P.current[t]=(0,l.createRef)(),(0,i.jsx)(o.Ee,{image:1===e.type?w:2===e.type?j:v,width:80,height:80,x:e.createdPosition.x-40,y:e.createdPosition.y-40,ref:P.current[t]},e.id)))})]})})};return(0,i.jsx)(n,{})};var b=_},6850:function(e){e.exports={container:"Lobby_container__Z__4u",button:"Lobby_button__HHfXL",buttons:"Lobby_buttons__F_DSz",title:"Lobby_title__Twjsl",text:"Lobby_text__csIbQ"}}},function(e){e.O(0,[289,774,888,179],function(){return e(e.s=171)}),_N_E=e.O()}]);