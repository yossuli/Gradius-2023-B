(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{171:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return i(9961)}])},9961:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return x}});var n=i(5893),r=i(1163),a=i(7294),l=i(2237);let s=e=>e*Math.PI/180,o=(e,t)=>{let i=(t-e.createdAt)/1e3,n=300*i*Math.cos(s(e.direction)),r=300*i*Math.sin(s(e.direction)),a=e.createdPosition.x+n,l=e.createdPosition.y+r;return[a,l]},d=e=>{let{bullet:t,currentTime:i}=e,[r,a]=o(t,i);return(0,n.jsx)(l.Cd,{x:r,y:a,radius:5,fill:"red"})};var u=i(1733),c=i(1290),h=i(4420),y=i.n(h);let p=()=>{let e=(0,r.useRouter)(),t=void 0===e.query.display?null:Number(e.query.display);if(console.log(t),null===t){let t=()=>{let[t,i]=(0,a.useState)(0),r=async()=>{let t=await c.x.game.config.$get();console.log(t),null!==t&&i(t),0===t&&e.push("/game/config")};return(0,a.useEffect)(()=>{r()},[]),(0,n.jsx)(n.Fragment,{children:[...Array(t)].map((t,i)=>(0,n.jsx)("button",{onClick:()=>e.push({query:{display:i}}),children:i},i))})};return(0,n.jsx)(t,{})}let i=()=>{let[e,i]=(0,a.useState)([]),[r,s]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[x,m]=(0,a.useState)(Date.now()),[f]=y()(u.D.images.spaceship_png),[g]=y()(u.D.images.ufo_jpg),w=async e=>{let t=await c.x.player.$get({query:{display:e}});null!==t&&i(t)},j=async e=>{let t=await c.x.enemy.$get({query:{display:e}});null!==t&&s(t)},_=async e=>{let t=await c.x.bullet.$get({query:{display:e}});null!==t&&p(t)},b=t=>{let n=e.map(e=>e.id===t?{...e,health:e.health-1}:e);i(n);let r=n.find(e=>e.id===t);r&&c.x.player.$patch({body:{player:r}})},P=()=>{let e=r.filter(e=>{let t=h.find(t=>{let i=o(t,x),n=Math.sqrt(Math.pow(e.createdPosition.x-i[0],2)+Math.pow(e.createdPosition.y-i[1],2));return n<50});return!t||!t.playerId||(c.x.enemy.$delete({body:{enemyId:e.id,userId:t.playerId}}),c.x.bullet.$delete({body:{bulletId:t.id}}),!1)});s(e)},q=()=>{let t=r.filter(t=>{let i=e.find(e=>{let i=Math.sqrt(Math.pow(t.createdPosition.x-e.position.x,2)+Math.pow(t.createdPosition.y-e.position.y,2));return i<50});return!i||(c.x.enemy.$delete({body:{enemyId:t.id,userId:i.id}}),b(i.id),!1)});s(t)};return(0,a.useEffect)(()=>{let e=requestAnimationFrame(()=>{w(t),j(t),_(t),P(),q(),m(Date.now())});return()=>cancelAnimationFrame(e)}),(0,n.jsx)("div",{children:(0,n.jsxs)(l.Hf,{width:1920,height:1080,children:[(0,n.jsx)(l.mh,{children:h.map(e=>(0,n.jsx)(d,{bullet:e,currentTime:x},e.id))}),(0,n.jsx)(l.mh,{children:e.map(e=>(0,n.jsx)(l.Ee,{image:f,width:100,height:100,rotation:"red"===e.team?90:-90,x:e.position.x+50,y:e.position.y-50},e.id))}),(0,n.jsx)(l.mh,{children:r.map(e=>(0,n.jsx)(l.Ee,{image:g,width:80,height:80,x:e.createdPosition.x,y:e.createdPosition.y},e.id))})]})})};return(0,n.jsx)(i,{})};var x=p}},function(e){e.O(0,[289,774,888,179],function(){return e(e.s=171)}),_N_E=e.O()}]);